
## Toolchain для RISC-V

[GitHub](https://github.com/riscv-collab/riscv-gnu-toolchain) 

Чтобы установить на Ubuntu:

1. Устанавливаем пререквизиты согласно рекомендациям в репозитории

```
sudo apt-get install autoconf automake autotools-dev curl python3 libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev ninja-build
```

Перед этим сделайте ```sudo apt-get update```.

2. ```git clone https://github.com/riscv-collab/riscv-gnu-toolchain```

3. ```cd riscv-gnu-toolchain```

4. Конфигурируем и собираем согласно рекомендациям в репозитории для newlib

```
./configure --prefix=/opt/riscv
make
```

Билд будет идти долго. Возможно, больше часа.
По ходу будет что-то еще клонироваться и конфигурироваться.
Это нормально.

В какой-то момент билд может упасть из-за невозможности что-то скопировать в
/opt/riscv. Это не совсем нормально. Я бы сказал, что это странность билда.
Обычно просто ```make``` используется для сборки, а ```make install``` - для установки.
А здесь просто ```make``` начинает что-то устанавливать.

Если такое случилось, перезапустите ```make``` как ```sudo make```. 
 
Но не стоит сразу делать ```sudo make```. Компиляция под суперпользователем - плохая практика.

5. После успешного билда добавьте следующую строку в ~/.bashrc:

```
export PATH=/opt/riscv/bin:$PATH
```

6. Закройте сеанс, зайдите в другой (чтобы активировать изменения в .bashrc)

7. Попробуйте запустить что-то вроде ```riscv64-unknown-elf-gcc```. Без указания пути.
Программа может ругаться, но она должна запуститься.


## Если у вас не Ubuntu, то есть два варианта:

1. Организовать Ubuntu-среду (Docker/VirtualBox/WSL)

2. Прокладывать путь самостоятельно. Вместо apt-get использовать yum, brew и т.п..

## Частые проблемы и их решения 

0. ```make``` жалуется на права доступа в /opt/riscv. Перезапустите как ```sudo make```

1. ```make``` жалуется на права доступа внутри вашего репозитория.

Скорее всего вы раньше времени запустили ```make``` под ```sudo```. Он создал каталог, у которого владелец - root.
А потом запускаете просто make, он там пытается что-то создать, но прав нет.

Удалите веcь репозиторий (под sudo), повторите все сначала, не делайте ```make``` под ```sudo``` раньше времени.

2. ```./configure: No such file or directory```

Запускаете ```configure``` вне репозитория

Зайдите в репозиторий.

3. Под WSL убедитесь, что у вас не оказалось файлов с Windows-style переводов строк.
Особенно если видите в диагностике '^M' или жалобы на абсолютно нормально выглядящую строку.


